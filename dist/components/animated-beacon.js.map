{"version":3,"file":"animated-beacon.js","sources":["../../src/components/animated-beacon.hbs","../../src/components/animated-beacon.ts"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{! template-lint-disable no-yield-only }}\\n{{yield}}\")","import Component from '@ember/component';\nimport { inject as service } from '@ember/service';\nimport { task, type Task } from '../-private/ember-scheduler.ts';\nimport { afterRender, microwait } from '../-private/concurrency-helpers.ts';\nimport { componentNodes } from '../-private/ember-internals.ts';\nimport Sprite from '../-private/sprite.ts';\nimport type MotionService from '../services/-ea-motion.ts';\n\ninterface AnimatedBeaconSignature {\n  Args: {\n    name: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\n/**\n  A component that marks a region of the page that\n  can serve as a source or destination for sprites to animate to and from.\n\n  ```hbs\n  {{#animated-beacon name=\"one\"}}\n    <button {{action \"launch\"}}>Launch</button>\n  {{/animated-beacon}}\n\n  {{#animated-if showThing use=transition}}\n    <div class=\"message\" {{action \"dismiss\"}}>\n      Hello\n    </div>\n  {{/animated-if}}\n  ```\n\n  ```js\n  import Component from '@ember/component';\n  import move from 'ember-animated/motions/move';\n  import scale from 'ember-animated/motions/scale';\n\n  export default Component.extend({\n    showThing: false,\n\n    transition: function *({ insertedSprites, keptSprites, removedSprites, beacons }) {\n      for (let sprite of insertedSprites) {\n        sprite.startAtSprite(beacons.one);\n        move(sprite);\n        scale(sprite);\n      }\n\n      for (let sprite of keptSprites) {\n        move(sprite);\n      }\n\n      for (let sprite of removedSprites) {\n        sprite.endAtSprite(beacons.one);\n        move(sprite);\n        scale(sprite);\n      }\n    });\n  },\n\n    actions: {\n      launch() {\n        this.set('showThing', true);\n      },\n      dismiss() {\n        this.set('showThing', false);\n      }\n    }\n  });\n  ```\n  @class animated-beacon\n  @public\n*/\nexport default class AnimatedBeacon extends Component<AnimatedBeaconSignature> {\n  name: string | undefined;\n\n  tagName = '';\n  _inserted = false;\n\n  @service('-ea-motion')\n  motionService!: MotionService;\n\n  didInsertElement() {\n    super.didInsertElement();\n    this._inserted = true;\n    this.animationStarting = this.animationStarting.bind(this);\n    this.motionService.observeAnimations(this.animationStarting);\n  }\n\n  willDestroyElement() {\n    super.willDestroyElement();\n    this.motionService.unobserveAnimations(this.animationStarting);\n  }\n\n  animationStarting() {\n    this.participate.perform();\n  }\n\n  _firstChildElement(): HTMLElement | SVGElement | undefined {\n    if (this._inserted) {\n      let { firstNode, lastNode } = componentNodes(\n        this as unknown as Component,\n      );\n      let node: Node | null = firstNode;\n      while (node) {\n        if (node.nodeType === Node.ELEMENT_NODE) {\n          return node as HTMLElement | SVGElement;\n        }\n        if (node === lastNode) {\n          break;\n        }\n        node = node.nextSibling;\n      }\n    }\n    return undefined;\n  }\n\n  @task(function* (this: AnimatedBeacon) {\n    if (!this.name) {\n      throw new Error('Beacons must have a name.');\n    }\n\n    if (this.motionService.hasBeacon(this.name)) {\n      return;\n    }\n\n    let element = this._firstChildElement();\n    if (!element) {\n      return;\n    }\n    let offsetParent = Sprite.offsetParentStartingAt(element);\n    let sprite = Sprite.positionedStartingAt(element, offsetParent);\n\n    yield afterRender();\n    yield microwait();\n    yield* this.motionService.staticMeasurement(() => {\n      offsetParent.measureFinalBounds();\n      sprite.measureFinalBounds();\n    });\n    yield this.motionService.addBeacon.perform(this.name, sprite);\n  })\n  participate!: Task;\n}\n"],"names":["AnimatedBeacon","_dec","service","_dec2","task","name","Error","motionService","hasBeacon","element","_firstChildElement","offsetParent","Sprite","offsetParentStartingAt","sprite","positionedStartingAt","afterRender","microwait","staticMeasurement","measureFinalBounds","addBeacon","perform","_class","Component","constructor","args","_defineProperty","_initializerDefineProperty","_descriptor","_descriptor2","didInsertElement","_inserted","animationStarting","bind","observeAnimations","willDestroyElement","unobserveAnimations","participate","firstNode","lastNode","componentNodes","node","nodeType","Node","ELEMENT_NODE","nextSibling","undefined","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","setComponentTemplate","TEMPLATE"],"mappings":"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"}