{"version":3,"file":"animated-beacon.js","sources":["../../src/components/animated-beacon.ts"],"sourcesContent":["import Component from '@ember/component';\nimport { inject as service } from '@ember/service';\nimport { task, type Task } from '../-private/ember-scheduler.ts';\nimport { afterRender, microwait } from '../-private/concurrency-helpers.ts';\nimport { componentNodes } from '../-private/ember-internals.ts';\nimport Sprite from '../-private/sprite.ts';\nimport type MotionService from '../services/-ea-motion.ts';\n\ninterface AnimatedBeaconSignature {\n  Args: {\n    name: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\n/**\n  A component that marks a region of the page that\n  can serve as a source or destination for sprites to animate to and from.\n\n  ```hbs\n  {{#animated-beacon name=\"one\"}}\n    <button {{action \"launch\"}}>Launch</button>\n  {{/animated-beacon}}\n\n  {{#animated-if showThing use=transition}}\n    <div class=\"message\" {{action \"dismiss\"}}>\n      Hello\n    </div>\n  {{/animated-if}}\n  ```\n\n  ```js\n  import Component from '@ember/component';\n  import move from 'ember-animated/motions/move';\n  import scale from 'ember-animated/motions/scale';\n\n  export default Component.extend({\n    showThing: false,\n\n    transition: function *({ insertedSprites, keptSprites, removedSprites, beacons }) {\n      for (let sprite of insertedSprites) {\n        sprite.startAtSprite(beacons.one);\n        move(sprite);\n        scale(sprite);\n      }\n\n      for (let sprite of keptSprites) {\n        move(sprite);\n      }\n\n      for (let sprite of removedSprites) {\n        sprite.endAtSprite(beacons.one);\n        move(sprite);\n        scale(sprite);\n      }\n    });\n  },\n\n    actions: {\n      launch() {\n        this.set('showThing', true);\n      },\n      dismiss() {\n        this.set('showThing', false);\n      }\n    }\n  });\n  ```\n  @class animated-beacon\n  @public\n*/\nexport default class AnimatedBeacon extends Component<AnimatedBeaconSignature> {\n  name: string | undefined;\n\n  tagName = '';\n  _inserted = false;\n\n  @service('-ea-motion')\n  motionService!: MotionService;\n\n  didInsertElement() {\n    super.didInsertElement();\n    this._inserted = true;\n    this.animationStarting = this.animationStarting.bind(this);\n    this.motionService.observeAnimations(this.animationStarting);\n  }\n\n  willDestroyElement() {\n    super.willDestroyElement();\n    this.motionService.unobserveAnimations(this.animationStarting);\n  }\n\n  animationStarting() {\n    this.participate.perform();\n  }\n\n  _firstChildElement(): HTMLElement | SVGElement | undefined {\n    if (this._inserted) {\n      let { firstNode, lastNode } = componentNodes(\n        this as unknown as Component,\n      );\n      let node: Node | null = firstNode;\n      while (node) {\n        if (node.nodeType === Node.ELEMENT_NODE) {\n          return node as HTMLElement | SVGElement;\n        }\n        if (node === lastNode) {\n          break;\n        }\n        node = node.nextSibling;\n      }\n    }\n    return undefined;\n  }\n\n  @task(function* (this: AnimatedBeacon) {\n    if (!this.name) {\n      throw new Error('Beacons must have a name.');\n    }\n\n    if (this.motionService.hasBeacon(this.name)) {\n      return;\n    }\n\n    let element = this._firstChildElement();\n    if (!element) {\n      return;\n    }\n    let offsetParent = Sprite.offsetParentStartingAt(element);\n    let sprite = Sprite.positionedStartingAt(element, offsetParent);\n\n    yield afterRender();\n    yield microwait();\n    yield* this.motionService.staticMeasurement(() => {\n      offsetParent.measureFinalBounds();\n      sprite.measureFinalBounds();\n    });\n    yield this.motionService.addBeacon.perform(this.name, sprite);\n  })\n  participate!: Task;\n}\n"],"names":["AnimatedBeacon","Component","name","tagName","_inserted","g","prototype","service","i","void 0","didInsertElement","animationStarting","bind","motionService","observeAnimations","willDestroyElement","unobserveAnimations","participate","perform","_firstChildElement","firstNode","lastNode","componentNodes","node","nodeType","Node","ELEMENT_NODE","nextSibling","undefined","task","Error","hasBeacon","element","offsetParent","Sprite","offsetParentStartingAt","sprite","positionedStartingAt","afterRender","microwait","staticMeasurement","measureFinalBounds","addBeacon","setComponentTemplate","TEMPLATE"],"mappings":"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"}