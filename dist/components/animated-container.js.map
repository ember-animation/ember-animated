{"version":3,"file":"animated-container.js","sources":["../../src/components/animated-container.hbs","../../src/components/animated-container.ts"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{#if this.useElementHelper}}\\n  {{!--\\n    The @class is only there to support a deprecated usage.\\n  --}}\\n  {{#let (element this.tag) as |Tag|~}}\\n    {{! @glint-ignore: https://github.com/typed-ember/glint/issues/610 }}\\n    <Tag class=\\\"animated-container {{@class}}\\\" ...attributes>\\n      {{yield}}\\n    </Tag>\\n  {{/let}}\\n{{else}}\\n  {{!--\\n    The @class is only there to support a deprecated usage.\\n  --}}\\n  {{! @glint-ignore }}\\n  {{#let (component (ensure-safe-component (-element this.tag)) tagName=this.tag) as |Tag|~}}\\n    {{! @glint-ignore }}\\n    <Tag class=\\\"animated-container {{@class}}\\\" ...attributes>\\n      {{yield}}\\n    </Tag>\\n  {{/let}}\\n{{/if}}\")","import { inject as service } from '@ember/service';\nimport Component from '@ember/component';\nimport { alias } from '@ember/object/computed';\nimport { action } from '@ember/object';\nimport { dependencySatisfies } from '@embroider/macros';\nimport { Resize } from '../motions/resize.ts';\nimport { task, type Task } from '../-private/ember-scheduler.ts';\nimport Sprite from '../-private/sprite.ts';\nimport { afterRender, microwait } from '../-private/concurrency-helpers.ts';\nimport { componentNodes } from '../-private/ember-internals.ts';\nimport type MotionService from '../services/-ea-motion.ts';\nimport type { MotionConstructor } from '../-private/motion.ts';\n\ninterface AnimatedContainerSignature<Tag extends string> {\n  /** Multiple tags supported for base element via `tag` arg */\n  // Element: ElementFromTagName<Tag>; // @todo https://github.com/typed-ember/glint/issues/610\n  Element: HTMLDivElement;\n  Args: {\n    motion?: string;\n\n    /** Whether to animate the initial render. You will probably also need to set initialInsertion=true on a child component of animated-container. Defaults to false. */\n    onInitialRender?: boolean;\n\n    /** Use a custom tag for the container. Defaults to div. */\n    tag?: Tag;\n    class?: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\n/**\n Provides a boundary between animator components and the surrounding document\n which smoothly resizes as animators change. Use animated-container whenever you\n need to \"hold a place for\" some animated content while that content is animating.\n  ```hbs\n  <button {{on \"click\" this.toggleThing}}>Toggle</button>\n  <AnimatedContainer>\n    {{#animated-if this.showThing use=this.transition }}\n        <div class=\"message\" {{on \"click\" this.toggleThing}}>\n            Hello!\n        </div>\n    {{/animated-if}}\n  </AnimatedContainer>\n  <p>\n    This is outside of the container.\n  </p>\n  ```\n  ```js\n  import Component from '@ember/component';\n  import { action } from '@ember/object';\n  import { tracked } from '@glimmer/tracking';\n  import move from 'ember-animated/motions/move';\n  import { easeOut, easeIn } from 'ember-animated/easings/cosine';\n\n  export default class AnimatedContainerComponentExample extends Component {\n    @tracked showThing = false;\n\n    @action\n    toggleThing() {\n      this.showThing = !this.showThing;\n    }\n\n    *transition({ insertedSprites, keptSprites, removedSprites }) {\n      for (let sprite of insertedSprites) {\n        sprite.startAtPixel({ x: window.innerWidth });\n        yield move(sprite, { easing: easeOut });\n      }\n\n      for (let sprite of keptSprites) {\n        yield move(sprite);\n      }\n\n      for (let sprite of removedSprites) {\n        sprite.endAtPixel({ x: window.innerWidth });\n        yield move(sprite, { easing: easeIn });\n      }\n    }\n  }\n  ```\n  @class animated-container\n  @public\n*/\nexport default class AnimatedContainerComponent<\n  Tag extends string = 'div',\n> extends Component<AnimatedContainerSignature<Tag>> {\n  tagName = '';\n\n  @service('-ea-motion')\n  motionService!: MotionService;\n\n  /**\n   * Use a custom tag for the container. Defaults to div.\n    @argument tag\n    @type String\n  */\n  tag = 'div' as const;\n  // @todo https://github.com/typed-ember/glint/issues/610\n  // tag: Tag = 'div' as Tag;\n\n  /**\n   * Whether to animate the initial render. You will probably also need to set\n   * initialInsertion=true on a child component of animated-container.\n   * Defaults to false.\n    @argument onInitialRender\n    @type Boolean\n  */\n  onInitialRender = false;\n\n  /**\n   * Use a custom tag for the container. Defaults to div.\n    @argument motion\n    @type String\n  */\n  motion: MotionConstructor = Resize;\n\n  private _inserted = false;\n  private _startingUp = false;\n  private sprite: Sprite | null = null;\n\n  constructor(properties: Record<string, unknown> | undefined) {\n    super(properties);\n    this.motionService\n      .register(this as any)\n      .observeDescendantAnimations(this as any, this.maybeAnimate); // TODO: shouldn't need this cast;\n  }\n\n  didInsertElement() {\n    super.didInsertElement();\n    this._inserted = true;\n  }\n\n  private _ownElement() {\n    if (!this._inserted) {\n      return undefined;\n    }\n    let { firstNode, lastNode } = componentNodes(this);\n    let node: Node | null = firstNode;\n    while (node) {\n      if (node.nodeType === Node.ELEMENT_NODE) {\n        return node as HTMLElement | SVGElement;\n      }\n      if (node === lastNode) {\n        break;\n      }\n      node = node.nextSibling;\n    }\n    return undefined;\n  }\n\n  willDestroyElement() {\n    super.willDestroyElement();\n    this.motionService\n      .unregister(this as any)\n      .unobserveDescendantAnimations(this as any, this.maybeAnimate); // TODO: shouldn't need this cast\n  }\n\n  @alias('animated.isRunning')\n  isAnimating!: boolean;\n\n  @action\n  maybeAnimate({ duration, task }: { duration: number; task: Promise<void> }) {\n    if (!this._startingUp) {\n      this.animate.perform(duration, task);\n    }\n  }\n\n  beginStaticMeasurement() {\n    if (this.sprite) {\n      this.sprite.unlock();\n    }\n  }\n\n  endStaticMeasurement() {\n    if (this.sprite) {\n      this.sprite.lock();\n    }\n  }\n\n  @task(function* (\n    this: AnimatedContainerComponent,\n    duration: number,\n    animationTask: Promise<void>,\n  ) {\n    this._startingUp = true;\n    let service = this.motionService;\n    let sprite: Sprite;\n    let useMotion;\n    let element = this._ownElement();\n\n    if (element) {\n      sprite = Sprite.sizedStartingAt(element);\n      this.sprite = sprite;\n      sprite.lock();\n      useMotion = true;\n    } else {\n      useMotion = this.onInitialRender;\n    }\n\n    try {\n      yield afterRender();\n      yield microwait();\n    } finally {\n      this._startingUp = false;\n    }\n\n    yield* service.staticMeasurement(() => {\n      if (!sprite) {\n        // ownElement is non-null here because we waited for render above, and\n        // our own template definitely contains an Element\n        sprite = Sprite.sizedEndingAt(this._ownElement()!);\n        this.sprite = sprite;\n      } else {\n        sprite.measureFinalBounds();\n      }\n    });\n\n    if (useMotion) {\n      yield* new this.motion(this.sprite!, { duration })._run();\n    }\n\n    yield animationTask;\n\n    this.sprite!.unlock();\n    this.sprite = null;\n  }).restartable()\n  animate!: Task;\n\n  get useElementHelper(): boolean {\n    return dependencySatisfies('ember-element-helper', '>=0.6.1');\n  }\n}\n"],"names":["AnimatedContainerComponent","_dec","service","_dec2","alias","_dec3","task","duration","animationTask","_startingUp","motionService","sprite","useMotion","element","_ownElement","Sprite","sizedStartingAt","lock","onInitialRender","afterRender","microwait","staticMeasurement","sizedEndingAt","measureFinalBounds","motion","_run","unlock","restartable","_class","Component","constructor","properties","_defineProperty","_initializerDefineProperty","_descriptor","Resize","_descriptor2","_descriptor3","register","observeDescendantAnimations","maybeAnimate","didInsertElement","_inserted","undefined","firstNode","lastNode","componentNodes","node","nodeType","Node","ELEMENT_NODE","nextSibling","willDestroyElement","unregister","unobserveDescendantAnimations","animate","perform","beginStaticMeasurement","endStaticMeasurement","useElementHelper","dependencySatisfies","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","action","Object","getOwnPropertyDescriptor","setComponentTemplate","TEMPLATE"],"mappings":";;;;;;;;;;;;;AACA,eAAe,kBAAkB,CAAC,uqBAAuqB;;;AC+BzsB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACqBA,IAAAA,0BAA0B,IAAAC,IAAA,GAK5CC,MAAO,CAAC,YAAY,CAAC,EAAAC,KAAA,GAqErBC,KAAK,CAAC,oBAAoB,CAAC,EAAAC,KAAA,GAsB3BC,IAAI,CAAC,WAEJC,QAAgB,EAChBC,aAA4B,EAC5B;EACA,IAAI,CAACC,WAAW,GAAG,IAAI,CAAA;AACvB,EAAA,IAAIP,OAAO,GAAG,IAAI,CAACQ,aAAa,CAAA;AAChC,EAAA,IAAIC,MAAc,CAAA;AAClB,EAAA,IAAIC,SAAS,CAAA;AACb,EAAA,IAAIC,OAAO,GAAG,IAAI,CAACC,WAAW,EAAE,CAAA;AAEhC,EAAA,IAAID,OAAO,EAAE;AACXF,IAAAA,MAAM,GAAGI,MAAM,CAACC,eAAe,CAACH,OAAO,CAAC,CAAA;IACxC,IAAI,CAACF,MAAM,GAAGA,MAAM,CAAA;IACpBA,MAAM,CAACM,IAAI,EAAE,CAAA;AACbL,IAAAA,SAAS,GAAG,IAAI,CAAA;AAClB,GAAC,MAAM;IACLA,SAAS,GAAG,IAAI,CAACM,eAAe,CAAA;AAClC,GAAA;EAEA,IAAI;IACF,MAAMC,WAAW,EAAE,CAAA;IACnB,MAAMC,SAAS,EAAE,CAAA;AACnB,GAAC,SAAS;IACR,IAAI,CAACX,WAAW,GAAG,KAAK,CAAA;AAC1B,GAAA;AAEA,EAAA,OAAOP,OAAO,CAACmB,iBAAiB,CAAC,MAAM;IACrC,IAAI,CAACV,MAAM,EAAE;AACX;AACA;MACAA,MAAM,GAAGI,MAAM,CAACO,aAAa,CAAC,IAAI,CAACR,WAAW,EAAG,CAAC,CAAA;MAClD,IAAI,CAACH,MAAM,GAAGA,MAAM,CAAA;AACtB,KAAC,MAAM;MACLA,MAAM,CAACY,kBAAkB,EAAE,CAAA;AAC7B,KAAA;AACF,GAAC,CAAC,CAAA;AAEF,EAAA,IAAIX,SAAS,EAAE;IACb,OAAO,IAAI,IAAI,CAACY,MAAM,CAAC,IAAI,CAACb,MAAM,EAAG;AAAEJ,MAAAA,QAAAA;AAAS,KAAC,CAAC,CAACkB,IAAI,EAAE,CAAA;AAC3D,GAAA;AAEA,EAAA,MAAMjB,aAAa,CAAA;AAEnB,EAAA,IAAI,CAACG,MAAM,CAAEe,MAAM,EAAE,CAAA;EACrB,IAAI,CAACf,MAAM,GAAG,IAAI,CAAA;AACpB,CAAC,CAAC,CAACgB,WAAW,EAAE,GAAAC,MAAA,GA9IH,MAAM5B,0BAA0B,SAErC6B,SAAS,CAAkC;EAmCnDC,WAAWA,CAACC,UAA+C,EAAE;IAC3D,KAAK,CAACA,UAAU,CAAC,CAAA;AAACC,IAAAA,eAAA,kBAnCV,EAAE,CAAA,CAAA;AAAAC,IAAAA,0BAAA,wBAAAC,WAAA,EAAA,IAAA,CAAA,CAAA;AAKZ;AACF;AACA;AACA;AACA;AAJEF,IAAAA,eAAA,cAKM,KAAK,CAAA,CAAA;AACX;AACA;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AANEA,IAAAA,eAAA,0BAOkB,KAAK,CAAA,CAAA;AAEvB;AACF;AACA;AACA;AACA;AAJEA,IAAAA,eAAA,iBAK4BG,MAAM,CAAA,CAAA;AAAAH,IAAAA,eAAA,oBAEd,KAAK,CAAA,CAAA;AAAAA,IAAAA,eAAA,sBACH,KAAK,CAAA,CAAA;AAAAA,IAAAA,eAAA,iBACK,IAAI,CAAA,CAAA;AAAAC,IAAAA,0BAAA,sBAAAG,YAAA,EAAA,IAAA,CAAA,CAAA;AAAAH,IAAAA,0BAAA,kBAAAI,YAAA,EAAA,IAAA,CAAA,CAAA;AAIlC,IAAA,IAAI,CAAC3B,aAAa,CACf4B,QAAQ,CAAC,IAAW,CAAC,CACrBC,2BAA2B,CAAC,IAAI,EAAS,IAAI,CAACC,YAAY,CAAC,CAAC;AACjE,GAAA;;AAEAC,EAAAA,gBAAgBA,GAAG;IACjB,KAAK,CAACA,gBAAgB,EAAE,CAAA;IACxB,IAAI,CAACC,SAAS,GAAG,IAAI,CAAA;AACvB,GAAA;AAEQ5B,EAAAA,WAAWA,GAAG;AACpB,IAAA,IAAI,CAAC,IAAI,CAAC4B,SAAS,EAAE;AACnB,MAAA,OAAOC,SAAS,CAAA;AAClB,KAAA;IACA,IAAI;MAAEC,SAAS;AAAEC,MAAAA,QAAAA;AAAS,KAAC,GAAGC,cAAc,CAAC,IAAI,CAAC,CAAA;IAClD,IAAIC,IAAiB,GAAGH,SAAS,CAAA;AACjC,IAAA,OAAOG,IAAI,EAAE;AACX,MAAA,IAAIA,IAAI,CAACC,QAAQ,KAAKC,IAAI,CAACC,YAAY,EAAE;AACvC,QAAA,OAAOH,IAAI,CAAA;AACb,OAAA;MACA,IAAIA,IAAI,KAAKF,QAAQ,EAAE;AACrB,QAAA,MAAA;AACF,OAAA;MACAE,IAAI,GAAGA,IAAI,CAACI,WAAW,CAAA;AACzB,KAAA;AACA,IAAA,OAAOR,SAAS,CAAA;AAClB,GAAA;AAEAS,EAAAA,kBAAkBA,GAAG;IACnB,KAAK,CAACA,kBAAkB,EAAE,CAAA;AAC1B,IAAA,IAAI,CAAC1C,aAAa,CACf2C,UAAU,CAAC,IAAW,CAAC,CACvBC,6BAA6B,CAAC,IAAI,EAAS,IAAI,CAACd,YAAY,CAAC,CAAC;AACnE,GAAA;;AAMAA,EAAAA,YAAYA,CAAC;IAAEjC,QAAQ;AAAED,IAAAA,IAAAA;AAAgD,GAAC,EAAE;AAC1E,IAAA,IAAI,CAAC,IAAI,CAACG,WAAW,EAAE;MACrB,IAAI,CAAC8C,OAAO,CAACC,OAAO,CAACjD,QAAQ,EAAED,IAAI,CAAC,CAAA;AACtC,KAAA;AACF,GAAA;AAEAmD,EAAAA,sBAAsBA,GAAG;IACvB,IAAI,IAAI,CAAC9C,MAAM,EAAE;AACf,MAAA,IAAI,CAACA,MAAM,CAACe,MAAM,EAAE,CAAA;AACtB,KAAA;AACF,GAAA;AAEAgC,EAAAA,oBAAoBA,GAAG;IACrB,IAAI,IAAI,CAAC/C,MAAM,EAAE;AACf,MAAA,IAAI,CAACA,MAAM,CAACM,IAAI,EAAE,CAAA;AACpB,KAAA;AACF,GAAA;EAmDA,IAAI0C,gBAAgBA,GAAY;AAC9B,IAAA,OAAOC,mBAAmB,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAA;AAC/D,GAAA;AACF,CAAC,GAAA1B,WAAA,GAAA2B,yBAAA,CAAAjC,MAAA,CAAAkC,SAAA,EAAA,eAAA,EAAA,CAAA7D,IAAA,CAAA,EAAA;EAAA8D,YAAA,EAAA,IAAA;EAAAC,UAAA,EAAA,IAAA;EAAAC,QAAA,EAAA,IAAA;EAAAC,WAAA,EAAA,IAAA;AAAA,CAAA9B,CAAAA,EAAAA,YAAA,GAAAyB,yBAAA,CAAAjC,MAAA,CAAAkC,SAAA,kBAAA3D,KAAA,CAAA,EAAA;EAAA4D,YAAA,EAAA,IAAA;EAAAC,UAAA,EAAA,IAAA;EAAAC,QAAA,EAAA,IAAA;EAAAC,WAAA,EAAA,IAAA;AAAA,CAAA,CAAA,EAAAL,yBAAA,CAAAjC,MAAA,CAAAkC,SAAA,EAAA,cAAA,EAAA,CAvEEK,MAAM,CAAA,EAAAC,MAAA,CAAAC,wBAAA,CAAAzC,MAAA,CAAAkC,SAAA,EAAA,cAAA,CAAA,EAAAlC,MAAA,CAAAkC,SAAA,CAAA,EAAAzB,YAAA,GAAAwB,yBAAA,CAAAjC,MAAA,CAAAkC,SAAA,EAAA,SAAA,EAAA,CAAAzD,KAAA,CAAA,EAAA;EAAA0D,YAAA,EAAA,IAAA;EAAAC,UAAA,EAAA,IAAA;EAAAC,QAAA,EAAA,IAAA;EAAAC,WAAA,EAAA,IAAA;AAAA,CAAA,CAAA,GAAAtC,MAAA,CAAA,EAAA;AA7EsC0C,oBAAA,CAAAC,QAAA,EAAAvE,0BAAA,CAAA;;;;"}