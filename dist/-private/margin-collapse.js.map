{"version":3,"file":"margin-collapse.js","sources":["../../src/-private/margin-collapse.ts"],"sourcesContent":["// takes an element, the element's computed style, and either 'top' or\n// 'bottom'.\n//\n// returns list of Element for increasingly deep descendants\n// of the given element whose top (or bottom) margin collapses with\n// the given element's.\nexport function collapsedChildren(\n  element: Element,\n  cs: CSSStyleDeclaration,\n  which: 'top' | 'bottom',\n  children: Element[] = [],\n) {\n  // margin collapse only happens if we have no border or padding\n  if (\n    isBlock(cs) &&\n    cs.getPropertyValue(`border-${which}-width`) === '0px' &&\n    cs.getPropertyValue(`padding-${which}`) === '0px'\n  ) {\n    let block;\n    if (which === 'top') {\n      block = firstChildBlock(element);\n    } else {\n      block = lastChildBlock(element);\n    }\n    if (block) {\n      let [child, childCS] = block;\n      children.push(child);\n      collapsedChildren(child, childCS, which, children);\n    }\n  }\n  return children;\n}\n\nfunction firstChildBlock(\n  element: Element,\n): [Element, CSSStyleDeclaration] | undefined {\n  for (let i = 0; i < element.children.length; i++) {\n    let child = element.children[i];\n    let childCS = getComputedStyle(child as Element);\n    if (childCS.clear !== 'none') {\n      // an intervening block with clearance prevents margin collapse\n      return;\n    }\n    if (isBlock(childCS)) {\n      return [child as Element, childCS];\n    }\n  }\n  return;\n}\n\nfunction lastChildBlock(\n  element: Element,\n): [Element, CSSStyleDeclaration] | undefined {\n  for (let i = element.children.length - 1; i >= 0; i--) {\n    let child = element.children[i];\n    let childCS = getComputedStyle(child as Element);\n    if (childCS.clear !== 'none') {\n      // an intervening block with clearance prevents margin collapse\n      return;\n    }\n    if (isBlock(childCS)) {\n      return [child as Element, childCS];\n    }\n  }\n  return;\n}\n\nfunction isBlock(cs: CSSStyleDeclaration) {\n  return (\n    cs.display === 'block' &&\n    (cs.position === 'static' || cs.position === 'relative') &&\n    cs.getPropertyValue('float') === 'none' &&\n    cs.overflow === 'visible'\n  );\n}\n"],"names":["collapsedChildren","element","cs","which","children","isBlock","getPropertyValue","block","firstChildBlock","lastChildBlock","child","childCS","push","i","length","getComputedStyle","clear","display","position","overflow"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,iBAAiBA,CAC/BC,OAAgB,EAChBC,EAAuB,EACvBC,KAAuB,EACvBC,QAAmB,GAAG,EAAE,EACxB;AACA;EACA,IACEC,OAAO,CAACH,EAAE,CAAC,IACXA,EAAE,CAACI,gBAAgB,CAAE,CAASH,OAAAA,EAAAA,KAAM,CAAO,MAAA,CAAA,CAAC,KAAK,KAAK,IACtDD,EAAE,CAACI,gBAAgB,CAAE,CAAUH,QAAAA,EAAAA,KAAM,CAAC,CAAA,CAAC,KAAK,KAAK,EACjD;AACA,IAAA,IAAII,KAAK,CAAA;IACT,IAAIJ,KAAK,KAAK,KAAK,EAAE;AACnBI,MAAAA,KAAK,GAAGC,eAAe,CAACP,OAAO,CAAC,CAAA;AAClC,KAAC,MAAM;AACLM,MAAAA,KAAK,GAAGE,cAAc,CAACR,OAAO,CAAC,CAAA;AACjC,KAAA;AACA,IAAA,IAAIM,KAAK,EAAE;AACT,MAAA,IAAI,CAACG,KAAK,EAAEC,OAAO,CAAC,GAAGJ,KAAK,CAAA;AAC5BH,MAAAA,QAAQ,CAACQ,IAAI,CAACF,KAAK,CAAC,CAAA;MACpBV,iBAAiB,CAACU,KAAK,EAAEC,OAAO,EAAER,KAAK,EAAEC,QAAQ,CAAC,CAAA;AACpD,KAAA;AACF,GAAA;AACA,EAAA,OAAOA,QAAQ,CAAA;AACjB,CAAA;AAEA,SAASI,eAAeA,CACtBP,OAAgB,EAC4B;AAC5C,EAAA,KAAK,IAAIY,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGZ,OAAO,CAACG,QAAQ,CAACU,MAAM,EAAED,CAAC,EAAE,EAAE;AAChD,IAAA,IAAIH,KAAK,GAAGT,OAAO,CAACG,QAAQ,CAACS,CAAC,CAAC,CAAA;AAC/B,IAAA,IAAIF,OAAO,GAAGI,gBAAgB,CAACL,KAAgB,CAAC,CAAA;AAChD,IAAA,IAAIC,OAAO,CAACK,KAAK,KAAK,MAAM,EAAE;AAC5B;AACA,MAAA,OAAA;AACF,KAAA;AACA,IAAA,IAAIX,OAAO,CAACM,OAAO,CAAC,EAAE;AACpB,MAAA,OAAO,CAACD,KAAK,EAAaC,OAAO,CAAC,CAAA;AACpC,KAAA;AACF,GAAA;AACA,EAAA,OAAA;AACF,CAAA;AAEA,SAASF,cAAcA,CACrBR,OAAgB,EAC4B;AAC5C,EAAA,KAAK,IAAIY,CAAC,GAAGZ,OAAO,CAACG,QAAQ,CAACU,MAAM,GAAG,CAAC,EAAED,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;AACrD,IAAA,IAAIH,KAAK,GAAGT,OAAO,CAACG,QAAQ,CAACS,CAAC,CAAC,CAAA;AAC/B,IAAA,IAAIF,OAAO,GAAGI,gBAAgB,CAACL,KAAgB,CAAC,CAAA;AAChD,IAAA,IAAIC,OAAO,CAACK,KAAK,KAAK,MAAM,EAAE;AAC5B;AACA,MAAA,OAAA;AACF,KAAA;AACA,IAAA,IAAIX,OAAO,CAACM,OAAO,CAAC,EAAE;AACpB,MAAA,OAAO,CAACD,KAAK,EAAaC,OAAO,CAAC,CAAA;AACpC,KAAA;AACF,GAAA;AACA,EAAA,OAAA;AACF,CAAA;AAEA,SAASN,OAAOA,CAACH,EAAuB,EAAE;AACxC,EAAA,OACEA,EAAE,CAACe,OAAO,KAAK,OAAO,KACrBf,EAAE,CAACgB,QAAQ,KAAK,QAAQ,IAAIhB,EAAE,CAACgB,QAAQ,KAAK,UAAU,CAAC,IACxDhB,EAAE,CAACI,gBAAgB,CAAC,OAAO,CAAC,KAAK,MAAM,IACvCJ,EAAE,CAACiB,QAAQ,KAAK,SAAS,CAAA;AAE7B;;;;"}