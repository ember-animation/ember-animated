{"version":3,"file":"ember-scheduler.js","sources":["../../src/-private/ember-scheduler.ts"],"sourcesContent":["import { join, scheduleOnce } from '@ember/runloop';\nimport { addObserver } from '@ember/object/observers';\nimport { computed, set } from '@ember/object';\nimport Ember from 'ember';\nimport { DEBUG } from '@glimmer/env';\nimport { spawn, current, stop, logErrors } from './scheduler.ts';\nimport { microwait } from './concurrency-helpers.ts';\nimport { getOrCreate as _getOrCreate } from './singleton.ts';\n\nfunction getOrCreate<T>(key: string, construct: () => T): T {\n  return _getOrCreate(`ember-scheduler.${key}`, construct);\n}\n\ntype HostObject = Record<string, any>;\n\nexport function task(taskFn: (...args: any[]) => Generator) {\n  let tp = _computed(function (this: HostObject, propertyName: string) {\n    return new Task(this, taskFn, tp, propertyName);\n  }) as unknown as TaskProperty;\n\n  Object.setPrototypeOf(tp, TaskProperty.prototype);\n  return tp as ((proto: any, key: string) => any) & TaskProperty;\n}\n\nfunction _computed(fn: (this: HostObject, propertyName: string) => Task) {\n  let cp = function (proto: HostObject, key: string) {\n    if ((cp as any).setup !== undefined) {\n      (cp as any).setup(proto, key);\n    }\n    // eslint-disable-next-line prefer-rest-params\n    return (computed(fn) as any)(...arguments);\n  };\n  (Ember as any)._setClassicDecorator(cp);\n  return cp;\n}\n\nlet handlerCounter = 0;\n\nlet BaseTaskProperty: { new (): HostObject };\n\nBaseTaskProperty = class {};\n\ntype BufferPolicy = (task: Task, priv: TaskPrivate) => Promise<void> | void;\n\nexport class TaskProperty extends BaseTaskProperty {\n  _bufferPolicy: BufferPolicy | undefined;\n  private _observes: string[] | undefined;\n\n  restartable() {\n    this._bufferPolicy = cancelAllButLast;\n    return this;\n  }\n\n  drop() {\n    this._bufferPolicy = drop;\n    return this;\n  }\n\n  observes(...deps: string[]) {\n    this._observes = deps;\n    return this;\n  }\n\n  setup(proto: HostObject, taskName: string) {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore: depending on the ember version we may or may not have a super\n    // method.\n    if (super.setup) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      super.setup(...arguments); // eslint-disable-line prefer-rest-params\n    }\n    if (this._observes) {\n      let handlerName = `_ember_animated_handler_${handlerCounter++}`;\n      (proto as any)[handlerName] = function () {\n        let task = this[taskName];\n        scheduleOnce('actions', task, '_safePerform');\n      };\n      for (let i = 0; i < this._observes.length; ++i) {\n        let name = this._observes[i];\n        (addObserver as any)(proto, name, null, handlerName);\n      }\n    }\n  }\n}\n\ninterface TaskPrivate {\n  context: HostObject;\n  implementation: (...args: unknown[]) => Generator;\n  instances: Promise<void>[];\n  taskProperty: TaskProperty;\n  name: string;\n}\n\nlet priv = getOrCreate<WeakMap<Task, TaskPrivate>>('priv', () => new WeakMap());\n\nfunction getPriv(task: Task): TaskPrivate {\n  return priv.get(task)!;\n}\n\nexport class Task {\n  concurrency = 0;\n  isRunning = false;\n\n  constructor(\n    context: any,\n    implementation: TaskPrivate['implementation'],\n    taskProperty: TaskProperty,\n    name: string,\n  ) {\n    priv.set(this, {\n      context,\n      implementation,\n      instances: [],\n      taskProperty,\n      name,\n    });\n  }\n  perform(...args: unknown[]) {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let self = this;\n    let privSelf = getPriv(this);\n    let context = privSelf.context;\n    let implementation = privSelf.implementation;\n    let policy = privSelf.taskProperty._bufferPolicy;\n    if ((context as any).isDestroyed) {\n      throw new Error(\n        `Tried to perform task ${privSelf.name} on an already destroyed object`,\n      );\n    }\n    cleanupOnDestroy(context, this);\n    return spawn(function* () {\n      if (DEBUG) {\n        logErrors((error) => {\n          microwait().then(() => {\n            throw error;\n          });\n        });\n      }\n\n      try {\n        self._addInstance(current()!);\n        if (policy) {\n          let maybeWait = policy(self, privSelf);\n          if (maybeWait) {\n            yield maybeWait;\n          }\n        }\n        let finalValue = yield* withRunLoop(\n          implementation.call(context, ...args),\n        );\n        return finalValue;\n      } finally {\n        join(() => {\n          self._removeInstance(current()!);\n        });\n      }\n    });\n  }\n  cancelAll() {\n    getPriv(this).instances.forEach((i) => stop(i));\n  }\n  _addInstance(i: Promise<void>) {\n    getPriv(this).instances.push(i);\n    set(this, 'isRunning', true);\n    set(this, 'concurrency', this.concurrency + 1);\n  }\n  _removeInstance(i: Promise<void>) {\n    let instances = getPriv(this).instances;\n    instances.splice(instances.indexOf(i), 1);\n    set(this, 'concurrency', this.concurrency - 1);\n    set(this, 'isRunning', this.concurrency > 0);\n  }\n  _safePerform() {\n    let { context } = getPriv(this);\n    if (!(context as any).isDestroyed) {\n      this.perform();\n    }\n  }\n}\n\n// cribbed from machty's ember-concurrency\nfunction cleanupOnDestroy(\n  owner: {\n    willDestroy?: ((...args: any[]) => void) & {\n      __ember_processes_destroyers__?: (() => void)[];\n    };\n  },\n  object: { cancelAll(): void },\n) {\n  if (!owner.willDestroy) {\n    // we're running in non Ember object (possibly in a test mock)\n    return;\n  }\n\n  if (!owner.willDestroy.__ember_processes_destroyers__) {\n    let oldWillDestroy = owner.willDestroy;\n    let disposers: (() => void)[] = [];\n\n    owner.willDestroy = function () {\n      for (const disposer of disposers) {\n        disposer();\n      }\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      oldWillDestroy.apply(owner, arguments); // eslint-disable-line prefer-rest-params\n    };\n    owner.willDestroy.__ember_processes_destroyers__ = disposers;\n  }\n\n  owner.willDestroy.__ember_processes_destroyers__.push(() => {\n    try {\n      object.cancelAll();\n    } catch (err) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      if (err.message !== 'TaskCancelation') {\n        throw err;\n      }\n    }\n  });\n}\n\nfunction cancelAllButLast(_task: Task, privTask: TaskPrivate) {\n  const instances = privTask.instances;\n  for (const instance of instances.slice(0, -1)) {\n    stop(instance);\n  }\n}\n\nfunction drop(_task: Task, privTask: TaskPrivate) {\n  let instances = privTask.instances;\n  for (let i = 1; i < instances.length; i++) {\n    stop(instances[i]!);\n  }\n}\n\nfunction* withRunLoop(generator: Generator): Generator {\n  let state!: IteratorResult<any>;\n  let threw: Error | undefined;\n  let nextValue: any;\n  let fulfilled = true;\n  while (true) {\n    join(() => {\n      try {\n        if (fulfilled) {\n          state = generator.next(nextValue);\n        } else {\n          state = generator.throw(nextValue);\n        }\n      } catch (err) {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        threw = err;\n      }\n    });\n\n    if (threw) {\n      throw threw;\n    }\n\n    if (state.done) {\n      return state.value;\n    }\n\n    try {\n      nextValue = yield state.value;\n      fulfilled = true;\n    } catch (err) {\n      nextValue = err;\n      fulfilled = false;\n    }\n  }\n}\n\nexport function timeout(ms: number) {\n  return new Promise<void>((resolve) => setTimeout(resolve, ms));\n}\n"],"names":["getOrCreate","key","construct","_getOrCreate","task","taskFn","tp","_computed","propertyName","Task","Object","setPrototypeOf","TaskProperty","prototype","fn","cp","proto","setup","undefined","computed","arguments","Ember","_setClassicDecorator","handlerCounter","BaseTaskProperty","constructor","args","_defineProperty","restartable","_bufferPolicy","cancelAllButLast","drop","observes","deps","_observes","taskName","handlerName","scheduleOnce","i","length","name","addObserver","priv","WeakMap","getPriv","get","context","implementation","taskProperty","set","instances","perform","self","privSelf","policy","isDestroyed","Error","cleanupOnDestroy","spawn","DEBUG","logErrors","error","microwait","then","_addInstance","current","maybeWait","finalValue","withRunLoop","call","join","_removeInstance","cancelAll","forEach","stop","push","concurrency","splice","indexOf","_safePerform","owner","object","willDestroy","__ember_processes_destroyers__","oldWillDestroy","disposers","disposer","apply","err","message","_task","privTask","instance","slice","generator","state","threw","nextValue","fulfilled","next","throw","done","value","timeout","ms","Promise","resolve","setTimeout"],"mappings":"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"}