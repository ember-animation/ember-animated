{"version":3,"file":"resize.js","sources":["../../src/motions/resize.ts"],"sourcesContent":["import { rAF } from '../-private/concurrency-helpers.ts';\nimport Motion, { type BaseOptions } from '../-private/motion.ts';\nimport Tween, { type DerivedTween } from '../-private/tween.ts';\nimport type Sprite from '../-private/sprite.ts';\n\ninterface Options extends BaseOptions {\n  easing: (t: number) => number;\n}\n\n/**\n  Smoothly resizes _sprite_ from its the initial size to its final size.\n\n  _sprite_ must have both `initialBounds` and `finalBounds` set.\n\n  Consider using `scale` instead because scale uses CSS transforms and will not trigger reflow.\n\n  ```js\n  for (let sprite of insertedSprites) {\n    sprite.startAtSprite(beacons['source']);\n    resize(sprite)\n  }\n  ```\n\n  @function resize\n  @export default\n  @param {Sprite} sprite\n  @return {Motion}\n*/\nexport default function resize(sprite: Sprite, opts: Partial<Options> = {}) {\n  return new Resize(sprite, opts).run();\n}\n\nexport class Resize extends Motion<Options> {\n  prior: Resize | null = null;\n  widthTween: Tween | DerivedTween | null = null;\n  heightTween: Tween | DerivedTween | null = null;\n\n  interrupted(motions: Motion[]) {\n    let prior = motions.find((m) => m instanceof this.constructor);\n    if (prior) {\n      this.prior = prior as Resize;\n    }\n  }\n\n  *animate() {\n    let sprite: Sprite = this.sprite;\n    let duration = this.duration;\n    let widthTween: Tween | DerivedTween;\n    let heightTween: Tween | DerivedTween;\n\n    sprite.assertHasInitialBounds();\n    sprite.assertHasFinalBounds();\n\n    if (!this.prior) {\n      widthTween = this.widthTween = new Tween(\n        sprite.initialBounds.width / sprite.initialCumulativeTransform.a,\n        sprite.finalBounds.width / sprite.finalCumulativeTransform.a,\n        duration,\n        this.opts.easing,\n      );\n      heightTween = this.heightTween = new Tween(\n        sprite.initialBounds.height / sprite.initialCumulativeTransform.d,\n        sprite.finalBounds.height / sprite.finalCumulativeTransform.d,\n        duration,\n        this.opts.easing,\n      );\n    } else {\n      widthTween = this.widthTween = new Tween(\n        0,\n        sprite.finalBounds.width / sprite.finalCumulativeTransform.a -\n          this.prior.sprite.finalBounds!.width,\n        duration,\n        this.opts.easing,\n      ).plus(this.prior.widthTween!);\n      heightTween = this.heightTween = new Tween(\n        0,\n        sprite.finalBounds.height / sprite.finalCumulativeTransform.d -\n          this.prior.sprite.finalBounds!.height,\n        duration,\n        this.opts.easing,\n      ).plus(this.prior.heightTween!);\n    }\n\n    while (!widthTween.done || !heightTween.done) {\n      sprite.applyStyles({\n        width: `${widthTween.currentValue}px`,\n        height: `${heightTween.currentValue}px`,\n      });\n      yield rAF();\n    }\n  }\n}\n"],"names":["resize","sprite","opts","Resize","run","Motion","prior","widthTween","heightTween","interrupted","motions","find","m","constructor","animate","duration","assertHasInitialBounds","assertHasFinalBounds","Tween","initialBounds","width","initialCumulativeTransform","a","finalBounds","finalCumulativeTransform","easing","height","d","plus","done","applyStyles","currentValue","rAF"],"mappings":"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"}