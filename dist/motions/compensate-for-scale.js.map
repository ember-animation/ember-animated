{"version":3,"file":"compensate-for-scale.js","sources":["../../src/motions/compensate-for-scale.ts"],"sourcesContent":["import { rAF } from '../-private/concurrency-helpers.ts';\nimport Motion, { type BaseOptions } from '../-private/motion.ts';\nimport type Sprite from '../-private/sprite.ts';\nimport Tween from '../-private/tween.ts';\n\nexport default function compensateForScale(\n  sprite: Sprite,\n  opts: Partial<BaseOptions> = {},\n) {\n  return new CompensateForScale(sprite, opts).run();\n}\n\nexport class CompensateForScale extends Motion {\n  widthTween: Tween | null = null;\n  heightTween: Tween | null = null;\n\n  *animate() {\n    let duration = this.duration;\n\n    this.sprite.assertHasInitialBounds();\n    this.sprite.assertHasFinalBounds();\n    let sprite = this.sprite;\n\n    let widthFactor =\n      sprite.finalCumulativeTransform.a / sprite.initialCumulativeTransform.a;\n    let heightFactor =\n      sprite.finalCumulativeTransform.d / sprite.initialCumulativeTransform.d;\n\n    this.widthTween = new Tween(\n      sprite.transform.a,\n      sprite.transform.a * widthFactor,\n      duration,\n    );\n    this.heightTween = new Tween(\n      sprite.transform.d,\n      sprite.transform.d * heightFactor,\n      duration,\n    );\n\n    while (!this.widthTween.done || !this.heightTween.done) {\n      sprite.scale(\n        this.widthTween.currentValue / sprite.transform.a,\n        this.heightTween.currentValue / sprite.transform.d,\n      );\n      yield rAF();\n    }\n  }\n}\n"],"names":["compensateForScale","sprite","opts","CompensateForScale","run","Motion","widthTween","heightTween","animate","duration","assertHasInitialBounds","assertHasFinalBounds","widthFactor","finalCumulativeTransform","a","initialCumulativeTransform","heightFactor","d","Tween","transform","done","scale","currentValue","rAF"],"mappings":";;;;AAKe,SAASA,kBAAkBA,CACxCC,MAAc,EACdC,IAA0B,GAAG,EAAE,EAC/B;EACA,OAAO,IAAIC,kBAAkB,CAACF,MAAM,EAAEC,IAAI,CAAC,CAACE,GAAG,EAAE;AACnD;AAEO,MAAMD,kBAAkB,SAASE,MAAM,CAAC;AAC7CC,EAAAA,UAAU,GAAiB,IAAI;AAC/BC,EAAAA,WAAW,GAAiB,IAAI;EAEhC,CAACC,OAAOA,GAAG;AACT,IAAA,IAAIC,QAAQ,GAAG,IAAI,CAACA,QAAQ;AAE5B,IAAA,IAAI,CAACR,MAAM,CAACS,sBAAsB,EAAE;AACpC,IAAA,IAAI,CAACT,MAAM,CAACU,oBAAoB,EAAE;AAClC,IAAA,IAAIV,MAAM,GAAG,IAAI,CAACA,MAAM;AAExB,IAAA,IAAIW,WAAW,GACbX,MAAM,CAACY,wBAAwB,CAACC,CAAC,GAAGb,MAAM,CAACc,0BAA0B,CAACD,CAAC;AACzE,IAAA,IAAIE,YAAY,GACdf,MAAM,CAACY,wBAAwB,CAACI,CAAC,GAAGhB,MAAM,CAACc,0BAA0B,CAACE,CAAC;IAEzE,IAAI,CAACX,UAAU,GAAG,IAAIY,KAAK,CACzBjB,MAAM,CAACkB,SAAS,CAACL,CAAC,EAClBb,MAAM,CAACkB,SAAS,CAACL,CAAC,GAAGF,WAAW,EAChCH,QACF,CAAC;IACD,IAAI,CAACF,WAAW,GAAG,IAAIW,KAAK,CAC1BjB,MAAM,CAACkB,SAAS,CAACF,CAAC,EAClBhB,MAAM,CAACkB,SAAS,CAACF,CAAC,GAAGD,YAAY,EACjCP,QACF,CAAC;AAED,IAAA,OAAO,CAAC,IAAI,CAACH,UAAU,CAACc,IAAI,IAAI,CAAC,IAAI,CAACb,WAAW,CAACa,IAAI,EAAE;MACtDnB,MAAM,CAACoB,KAAK,CACV,IAAI,CAACf,UAAU,CAACgB,YAAY,GAAGrB,MAAM,CAACkB,SAAS,CAACL,CAAC,EACjD,IAAI,CAACP,WAAW,CAACe,YAAY,GAAGrB,MAAM,CAACkB,SAAS,CAACF,CACnD,CAAC;MACD,MAAMM,GAAG,EAAE;AACb;AACF;AACF;;;;"}