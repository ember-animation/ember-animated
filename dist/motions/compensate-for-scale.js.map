{"version":3,"file":"compensate-for-scale.js","sources":["../../src/motions/compensate-for-scale.ts"],"sourcesContent":["import { rAF } from '../-private/concurrency-helpers.ts';\nimport Motion, { type BaseOptions } from '../-private/motion.ts';\nimport type Sprite from '../-private/sprite.ts';\nimport Tween from '../-private/tween.ts';\n\nexport default function compensateForScale(\n  sprite: Sprite,\n  opts: Partial<BaseOptions> = {},\n) {\n  return new CompensateForScale(sprite, opts).run();\n}\n\nexport class CompensateForScale extends Motion {\n  widthTween: Tween | null = null;\n  heightTween: Tween | null = null;\n\n  *animate() {\n    let duration = this.duration;\n\n    this.sprite.assertHasInitialBounds();\n    this.sprite.assertHasFinalBounds();\n    let sprite = this.sprite;\n\n    let widthFactor =\n      sprite.finalCumulativeTransform.a / sprite.initialCumulativeTransform.a;\n    let heightFactor =\n      sprite.finalCumulativeTransform.d / sprite.initialCumulativeTransform.d;\n\n    this.widthTween = new Tween(\n      sprite.transform.a,\n      sprite.transform.a * widthFactor,\n      duration,\n    );\n    this.heightTween = new Tween(\n      sprite.transform.d,\n      sprite.transform.d * heightFactor,\n      duration,\n    );\n\n    while (!this.widthTween.done || !this.heightTween.done) {\n      sprite.scale(\n        this.widthTween.currentValue / sprite.transform.a,\n        this.heightTween.currentValue / sprite.transform.d,\n      );\n      yield rAF();\n    }\n  }\n}\n"],"names":["compensateForScale","sprite","opts","CompensateForScale","run","Motion","constructor","args","_defineProperty","animate","duration","assertHasInitialBounds","assertHasFinalBounds","widthFactor","finalCumulativeTransform","a","initialCumulativeTransform","heightFactor","d","widthTween","Tween","transform","heightTween","done","scale","currentValue","rAF"],"mappings":";;;;;AAKe,SAASA,kBAAkBA,CACxCC,MAAc,EACdC,IAA0B,GAAG,EAAE,EAC/B;EACA,OAAO,IAAIC,kBAAkB,CAACF,MAAM,EAAEC,IAAI,CAAC,CAACE,GAAG,EAAE,CAAA;AACnD,CAAA;AAEO,MAAMD,kBAAkB,SAASE,MAAM,CAAC;AAAAC,EAAAA,WAAAA,CAAA,GAAAC,IAAA,EAAA;AAAA,IAAA,KAAA,CAAA,GAAAA,IAAA,CAAA,CAAA;AAAAC,IAAAA,eAAA,qBAClB,IAAI,CAAA,CAAA;AAAAA,IAAAA,eAAA,sBACH,IAAI,CAAA,CAAA;AAAA,GAAA;EAEhC,CAACC,OAAOA,GAAG;AACT,IAAA,IAAIC,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAAA;AAE5B,IAAA,IAAI,CAACT,MAAM,CAACU,sBAAsB,EAAE,CAAA;AACpC,IAAA,IAAI,CAACV,MAAM,CAACW,oBAAoB,EAAE,CAAA;AAClC,IAAA,IAAIX,MAAM,GAAG,IAAI,CAACA,MAAM,CAAA;AAExB,IAAA,IAAIY,WAAW,GACbZ,MAAM,CAACa,wBAAwB,CAACC,CAAC,GAAGd,MAAM,CAACe,0BAA0B,CAACD,CAAC,CAAA;AACzE,IAAA,IAAIE,YAAY,GACdhB,MAAM,CAACa,wBAAwB,CAACI,CAAC,GAAGjB,MAAM,CAACe,0BAA0B,CAACE,CAAC,CAAA;IAEzE,IAAI,CAACC,UAAU,GAAG,IAAIC,KAAK,CACzBnB,MAAM,CAACoB,SAAS,CAACN,CAAC,EAClBd,MAAM,CAACoB,SAAS,CAACN,CAAC,GAAGF,WAAW,EAChCH,QACF,CAAC,CAAA;IACD,IAAI,CAACY,WAAW,GAAG,IAAIF,KAAK,CAC1BnB,MAAM,CAACoB,SAAS,CAACH,CAAC,EAClBjB,MAAM,CAACoB,SAAS,CAACH,CAAC,GAAGD,YAAY,EACjCP,QACF,CAAC,CAAA;AAED,IAAA,OAAO,CAAC,IAAI,CAACS,UAAU,CAACI,IAAI,IAAI,CAAC,IAAI,CAACD,WAAW,CAACC,IAAI,EAAE;MACtDtB,MAAM,CAACuB,KAAK,CACV,IAAI,CAACL,UAAU,CAACM,YAAY,GAAGxB,MAAM,CAACoB,SAAS,CAACN,CAAC,EACjD,IAAI,CAACO,WAAW,CAACG,YAAY,GAAGxB,MAAM,CAACoB,SAAS,CAACH,CACnD,CAAC,CAAA;MACD,MAAMQ,GAAG,EAAE,CAAA;AACb,KAAA;AACF,GAAA;AACF;;;;"}