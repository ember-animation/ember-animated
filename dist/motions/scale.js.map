{"version":3,"file":"scale.js","sources":["../../src/motions/scale.ts"],"sourcesContent":["import { rAF } from '../-private/concurrency-helpers.ts';\nimport Motion, { type BaseOptions } from '../-private/motion.ts';\nimport type Sprite from '../-private/sprite.ts';\nimport Tween, { type TweenLike } from '../-private/tween.ts';\n\n/**\n  Smoothly scales _sprite_ from its the initial size to its final size.\n\n  _sprite_ must have both `initialBounds` and `finalBounds` set.\n\n  ```js\n  for (let sprite of insertedSprites) {\n    sprite.startAtSprite(beacons['source']);\n    scale(sprite)\n  }\n  ```\n\n  @function scale\n  @export default\n  @param {Sprite} sprite\n  @return {Motion}\n*/\nexport default function scale(\n  sprite: Sprite,\n  opts: Partial<ScaleOptions> = {},\n) {\n  return new Scale(sprite, opts).run();\n}\n\ninterface ScaleOptions extends BaseOptions {\n  easing: (time: number) => number;\n}\n\nexport class Scale extends Motion<ScaleOptions> {\n  widthTween: TweenLike | null = null;\n  heightTween: TweenLike | null = null;\n\n  *animate() {\n    this.sprite.assertHasInitialBounds();\n    this.sprite.assertHasFinalBounds();\n    let sprite = this.sprite;\n\n    let duration = this.duration;\n\n    let initialWidthFactor, initialHeightFactor;\n\n    if (sprite.originalInitialBounds) {\n      // the sprite is going to start at its own native initial size,\n      // which may differ from the initialBounds.width &\n      // initialBounds.height that have been set for it. This\n      // compensates with an initial scaling.\n      initialWidthFactor =\n        sprite.initialBounds.width / sprite.originalInitialBounds.width;\n      initialHeightFactor =\n        sprite.initialBounds.height / sprite.originalInitialBounds.height;\n    } else {\n      // the sprite is going to start at its own native final size\n      initialWidthFactor =\n        sprite.initialBounds.width / sprite.originalFinalBounds.width;\n      initialHeightFactor =\n        sprite.initialBounds.height / sprite.originalFinalBounds.height;\n    }\n\n    let widthFactor = sprite.finalBounds.width / sprite.initialBounds.width;\n    let heightFactor = sprite.finalBounds.height / sprite.initialBounds.height;\n\n    this.widthTween = new Tween(\n      sprite.transform.a * initialWidthFactor,\n      sprite.transform.a * initialWidthFactor * widthFactor,\n      duration,\n      this.opts.easing,\n    );\n    this.heightTween = new Tween(\n      sprite.transform.d * initialHeightFactor,\n      sprite.transform.d * initialHeightFactor * heightFactor,\n      duration,\n      this.opts.easing,\n    );\n\n    while (!this.widthTween.done || !this.heightTween.done) {\n      sprite.scale(\n        this.widthTween.currentValue / sprite.transform.a,\n        this.heightTween.currentValue / sprite.transform.d,\n      );\n      yield rAF();\n    }\n  }\n}\n"],"names":["scale","sprite","opts","Scale","run","Motion","constructor","args","_defineProperty","animate","assertHasInitialBounds","assertHasFinalBounds","duration","initialWidthFactor","initialHeightFactor","originalInitialBounds","initialBounds","width","height","originalFinalBounds","widthFactor","finalBounds","heightFactor","widthTween","Tween","transform","a","easing","heightTween","d","done","currentValue","rAF"],"mappings":"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"}