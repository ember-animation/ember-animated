{"version":3,"file":"opacity.js","sources":["../../src/motions/opacity.ts"],"sourcesContent":["import { rAF } from '../-private/concurrency-helpers.ts';\nimport Motion, { type BaseOptions } from '../-private/motion.ts';\nimport type Sprite from '../-private/sprite.ts';\nimport Tween, { type TweenLike } from '../-private/tween.ts';\nimport linear from '../easings/linear.ts';\n\nexport default function opacity(\n  sprite: Sprite,\n  opts: Partial<OpacityOptions> = {},\n) {\n  return new Opacity(sprite, opts).run();\n}\n\n/**\n  Animates in a sprite from 0% to 100% opacity.\n\n  ```js\n  for (let sprite of insertedSprites) {\n    fadeIn(sprite)\n  }\n  ```\n\n  @function fadeIn\n  @param {Sprite} sprite\n  @return {Motion}\n*/\nexport function fadeIn(sprite: Sprite, opts: Partial<OpacityOptions> = {}) {\n  let innerOpts = Object.assign(\n    {\n      to: 1,\n    },\n    opts,\n  );\n  return opacity(sprite, innerOpts);\n}\n\n/**\n  Animates out a sprite from 100% to 0% opacity.\n\n  ```js\n  for (let sprite of removedSprites) {\n    fadeOut(sprite)\n  }\n  ```\n\n  @function fadeOut\n  @param {Sprite} sprite\n  @return {Motion}\n*/\nexport function fadeOut(sprite: Sprite, opts: Partial<OpacityOptions> = {}) {\n  let innerOpts = Object.assign(\n    {\n      to: 0,\n    },\n    opts,\n  );\n  return opacity(sprite, innerOpts);\n}\n\ninterface OpacityOptions extends BaseOptions {\n  from: number;\n  to: number;\n  easing: (time: number) => number;\n}\n\nexport class Opacity extends Motion<OpacityOptions> {\n  prior: Opacity | null | undefined = null;\n  tween: TweenLike | null = null;\n\n  interrupted(motions: Motion[]) {\n    // SAFTEY: We just checked the types\n    this.prior = motions.find((m) => m instanceof this.constructor) as\n      | Opacity\n      | undefined;\n  }\n\n  /*\n    This motion defines \"duration\" as the time it takes to go all the\n    way from 0% to 100% (or 100% to 0%). So motions between values\n    closer than that take proportionately less time.\n  */\n  *animate() {\n    let { sprite, duration, opts } = this;\n    let to =\n      opts.to != null\n        ? opts.to\n        : sprite.finalComputedStyle != null\n          ? parseFloat(sprite.finalComputedStyle.opacity)\n          : 1;\n    let from;\n\n    if (this.prior) {\n      let prior: Opacity = this.prior;\n      prior.assertHasTween();\n\n      // when we're interrupting a prior opacity motion, we always\n      // take its value as our starting point, regardless of whether\n      // the user set a \"from\" option.\n      from = prior.tween.currentValue;\n    } else {\n      // otherwise we start at the user-provided option, the sprite's\n      // found initial opacity, or zero, in that priority order.\n      from =\n        opts.from != null\n          ? opts.from\n          : sprite.initialComputedStyle != null\n            ? parseFloat(sprite.initialComputedStyle.opacity)\n            : 0;\n    }\n\n    let proportionalDuration = Math.abs(from - to) * duration;\n    this.tween = new Tween(\n      from,\n      to,\n      proportionalDuration,\n      this.opts.easing !== undefined ? this.opts.easing : linear,\n    );\n\n    while (!this.tween.done) {\n      sprite.applyStyles({\n        opacity: `${this.tween.currentValue}`,\n      });\n      yield rAF();\n    }\n  }\n\n  assertHasTween(): asserts this is OpacityWithTween {\n    if (!this.tween) {\n      throw new Error(`motion does not have tween`);\n    }\n  }\n}\n\ninterface OpacityWithTween extends Opacity {\n  tween: TweenLike;\n}\n"],"names":["opacity","sprite","opts","Opacity","run","fadeIn","innerOpts","Object","assign","to","fadeOut","Motion","constructor","args","_defineProperty","interrupted","motions","prior","find","m","animate","duration","finalComputedStyle","parseFloat","from","assertHasTween","tween","currentValue","initialComputedStyle","proportionalDuration","Math","abs","Tween","easing","undefined","linear","done","applyStyles","rAF","Error"],"mappings":"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"}