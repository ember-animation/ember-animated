{"version":3,"file":"follow.js","sources":["../../src/motions/follow.ts"],"sourcesContent":["import { Move, type MoveOptions } from './move.ts';\nimport { rAF } from '../-private/concurrency-helpers.ts';\nimport type Sprite from '../-private/sprite.ts';\nimport Tween from '../-private/tween.ts';\n\nexport default function follow(\n  sprite: Sprite,\n  opts: Partial<FollowOptions> = {},\n) {\n  return new Follow(sprite, opts).run();\n}\n\ninterface FollowOptions extends MoveOptions {\n  source: Move;\n}\n\n// Because we inherit from Move, if we are interrupted by a Move the\n// new Move will still preserve our momentum.\nexport class Follow extends Move<FollowOptions> {\n  readonly source: Move;\n\n  constructor(sprite: Sprite, opts: Partial<MoveOptions> = {}) {\n    super(sprite, opts);\n    if (!(this.opts.source instanceof Move)) {\n      throw new Error('Follow requires a `source` Move to follow');\n    }\n    this.source = this.opts.source;\n  }\n\n  *animate() {\n    this.source.assertHasTweens();\n    let source = this.source;\n\n    let sprite = this.sprite;\n    let transformOffsetX = sprite.transform.tx - source.sprite.transform.tx;\n    let transformOffsetY = sprite.transform.ty - source.sprite.transform.ty;\n    this.xTween = new Tween(transformOffsetX, transformOffsetX, 0).plus(\n      source.xTween,\n    );\n    this.yTween = new Tween(transformOffsetY, transformOffsetY, 0).plus(\n      source.yTween,\n    );\n\n    // We don't need this to make our own animation work correctly,\n    // but since we are a subclass of Move, and every Move requires\n    // its sprite to have both initial and final bounds, we need to\n    // this to remain protocol-compatible across interruptions.\n\n    this.sprite.endRelativeTo(source.sprite);\n\n    while (!this.xTween.done || !this.yTween.done) {\n      sprite.translate(\n        this.xTween.currentValue - sprite.transform.tx,\n        this.yTween.currentValue - sprite.transform.ty,\n      );\n      yield rAF();\n    }\n  }\n}\n"],"names":["follow","sprite","opts","Follow","run","Move","constructor","_defineProperty","source","Error","animate","assertHasTweens","transformOffsetX","transform","tx","transformOffsetY","ty","xTween","Tween","plus","yTween","endRelativeTo","done","translate","currentValue","rAF"],"mappings":";;;;;AAKe,SAASA,MAAMA,CAC5BC,MAAc,EACdC,IAA4B,GAAG,EAAE,EACjC;EACA,OAAO,IAAIC,MAAM,CAACF,MAAM,EAAEC,IAAI,CAAC,CAACE,GAAG,EAAE,CAAA;AACvC,CAAA;AAMA;AACA;AACO,MAAMD,MAAM,SAASE,IAAI,CAAgB;AAG9CC,EAAAA,WAAWA,CAACL,MAAc,EAAEC,IAA0B,GAAG,EAAE,EAAE;AAC3D,IAAA,KAAK,CAACD,MAAM,EAAEC,IAAI,CAAC,CAAA;IAACK,eAAA,CAAA,IAAA,EAAA,QAAA,EAAA,KAAA,CAAA,CAAA,CAAA;IACpB,IAAI,EAAE,IAAI,CAACL,IAAI,CAACM,MAAM,YAAYH,IAAI,CAAC,EAAE;AACvC,MAAA,MAAM,IAAII,KAAK,CAAC,2CAA2C,CAAC,CAAA;AAC9D,KAAA;AACA,IAAA,IAAI,CAACD,MAAM,GAAG,IAAI,CAACN,IAAI,CAACM,MAAM,CAAA;AAChC,GAAA;EAEA,CAACE,OAAOA,GAAG;AACT,IAAA,IAAI,CAACF,MAAM,CAACG,eAAe,EAAE,CAAA;AAC7B,IAAA,IAAIH,MAAM,GAAG,IAAI,CAACA,MAAM,CAAA;AAExB,IAAA,IAAIP,MAAM,GAAG,IAAI,CAACA,MAAM,CAAA;AACxB,IAAA,IAAIW,gBAAgB,GAAGX,MAAM,CAACY,SAAS,CAACC,EAAE,GAAGN,MAAM,CAACP,MAAM,CAACY,SAAS,CAACC,EAAE,CAAA;AACvE,IAAA,IAAIC,gBAAgB,GAAGd,MAAM,CAACY,SAAS,CAACG,EAAE,GAAGR,MAAM,CAACP,MAAM,CAACY,SAAS,CAACG,EAAE,CAAA;AACvE,IAAA,IAAI,CAACC,MAAM,GAAG,IAAIC,KAAK,CAACN,gBAAgB,EAAEA,gBAAgB,EAAE,CAAC,CAAC,CAACO,IAAI,CACjEX,MAAM,CAACS,MACT,CAAC,CAAA;AACD,IAAA,IAAI,CAACG,MAAM,GAAG,IAAIF,KAAK,CAACH,gBAAgB,EAAEA,gBAAgB,EAAE,CAAC,CAAC,CAACI,IAAI,CACjEX,MAAM,CAACY,MACT,CAAC,CAAA;;AAED;AACA;AACA;AACA;;IAEA,IAAI,CAACnB,MAAM,CAACoB,aAAa,CAACb,MAAM,CAACP,MAAM,CAAC,CAAA;AAExC,IAAA,OAAO,CAAC,IAAI,CAACgB,MAAM,CAACK,IAAI,IAAI,CAAC,IAAI,CAACF,MAAM,CAACE,IAAI,EAAE;MAC7CrB,MAAM,CAACsB,SAAS,CACd,IAAI,CAACN,MAAM,CAACO,YAAY,GAAGvB,MAAM,CAACY,SAAS,CAACC,EAAE,EAC9C,IAAI,CAACM,MAAM,CAACI,YAAY,GAAGvB,MAAM,CAACY,SAAS,CAACG,EAC9C,CAAC,CAAA;MACD,MAAMS,GAAG,EAAE,CAAA;AACb,KAAA;AACF,GAAA;AACF;;;;"}