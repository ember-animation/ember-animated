{"version":3,"file":"move-svg.js","sources":["../../src/motions/move-svg.ts"],"sourcesContent":["import Motion, { type BaseOptions } from '../-private/motion.ts';\nimport type Sprite from '../-private/sprite.ts';\nimport { type SVGPosition } from '../-private/sprite.ts';\nimport Tween, { type TweenLike } from '../-private/tween.ts';\nimport { rAF } from '../-private/concurrency-helpers.ts';\n\nexport default function moveSVG(\n  dimension: keyof SVGPosition,\n  sprite: Sprite,\n  opts: Partial<MoveSVGOptions> = {},\n) {\n  return new MoveSVG(dimension, sprite, opts).run();\n}\n\nmoveSVG.property = function (propertyName: keyof SVGPosition) {\n  return this.bind(null, propertyName);\n};\n\ninterface MoveSVGOptions extends BaseOptions {\n  easing: (time: number) => number;\n}\n\nexport class MoveSVG extends Motion<MoveSVGOptions> {\n  prior: MoveSVG | null | undefined = null;\n  tween: TweenLike | null = null;\n\n  constructor(\n    readonly dimension: keyof SVGPosition,\n    sprite: Sprite,\n    opts: Partial<MoveSVGOptions> = {},\n  ) {\n    super(sprite, opts);\n  }\n\n  interrupted(motions: Motion[]) {\n    this.prior = motions.find(\n      (m) => m instanceof MoveSVG && m.dimension === this.dimension,\n      // SAFETY: We just checked the type of this\n    ) as MoveSVG | undefined;\n  }\n\n  *animate() {\n    if (this.prior) {\n      let prior: MoveSVG = this.prior;\n      prior.assertHasTween();\n\n      this.tween = new Tween(\n        0,\n        Number(this.sprite.getFinalDimension(this.dimension)) -\n          prior.tween.finalValue,\n        this.duration,\n        this.opts.easing,\n      ).plus(prior.tween);\n    } else {\n      this.tween = new Tween(\n        Number(this.sprite.getInitialDimension(this.dimension)),\n        Number(this.sprite.getFinalDimension(this.dimension)),\n        this.duration,\n        this.opts.easing,\n      );\n    }\n    while (!this.tween.done) {\n      // SAFETY: This is not very safe!\n      (this.sprite.element as any)[this.dimension].baseVal.value =\n        this.tween.currentValue;\n      yield rAF();\n    }\n  }\n\n  assertHasTween(): asserts this is MoveSVGWithTween {\n    if (!this.tween) {\n      throw new Error(`motion does not have tween`);\n    }\n  }\n}\n\ninterface MoveSVGWithTween extends MoveSVG {\n  tween: TweenLike;\n}\n"],"names":["moveSVG","dimension","sprite","opts","MoveSVG","run","property","propertyName","bind","Motion","prior","tween","constructor","interrupted","motions","find","m","animate","assertHasTween","Tween","Number","getFinalDimension","finalValue","duration","easing","plus","getInitialDimension","done","element","baseVal","value","currentValue","rAF","Error"],"mappings":";;;;;AAMe,SAASA,OAAOA,CAC7BC,SAA4B,EAC5BC,MAAc,EACdC,IAA6B,GAAG,EAAE,EAClC;AACA,EAAA,OAAO,IAAIC,OAAO,CAACH,SAAS,EAAEC,MAAM,EAAEC,IAAI,CAAC,CAACE,GAAG,EAAE;AACnD;AAEAL,OAAO,CAACM,QAAQ,GAAG,UAAUC,YAA+B,EAAE;AAC5D,EAAA,OAAO,IAAI,CAACC,IAAI,CAAC,IAAI,EAAED,YAAY,CAAC;AACtC,CAAC;AAMM,MAAMH,OAAO,SAASK,MAAM,CAAiB;AAClDC,EAAAA,KAAK,GAA+B,IAAI;AACxCC,EAAAA,KAAK,GAAqB,IAAI;EAE9BC,WAAWA,CACAX,SAA4B,EACrCC,MAAc,EACdC,IAA6B,GAAG,EAAE,EAClC;AACA,IAAA,KAAK,CAACD,MAAM,EAAEC,IAAI,CAAC;IAAC,IAJXF,CAAAA,SAA4B,GAA5BA,SAA4B;AAKvC;EAEAY,WAAWA,CAACC,OAAiB,EAAE;AAC7B,IAAA,IAAI,CAACJ,KAAK,GAAGI,OAAO,CAACC,IAAI,CACtBC,CAAC,IAAKA,CAAC,YAAYZ,OAAO,IAAIY,CAAC,CAACf,SAAS,KAAK,IAAI,CAACA;AACpD;KACsB;AAC1B;EAEA,CAACgB,OAAOA,GAAG;IACT,IAAI,IAAI,CAACP,KAAK,EAAE;AACd,MAAA,IAAIA,KAAc,GAAG,IAAI,CAACA,KAAK;MAC/BA,KAAK,CAACQ,cAAc,EAAE;MAEtB,IAAI,CAACP,KAAK,GAAG,IAAIQ,KAAK,CACpB,CAAC,EACDC,MAAM,CAAC,IAAI,CAAClB,MAAM,CAACmB,iBAAiB,CAAC,IAAI,CAACpB,SAAS,CAAC,CAAC,GACnDS,KAAK,CAACC,KAAK,CAACW,UAAU,EACxB,IAAI,CAACC,QAAQ,EACb,IAAI,CAACpB,IAAI,CAACqB,MACZ,CAAC,CAACC,IAAI,CAACf,KAAK,CAACC,KAAK,CAAC;AACrB,KAAC,MAAM;AACL,MAAA,IAAI,CAACA,KAAK,GAAG,IAAIQ,KAAK,CACpBC,MAAM,CAAC,IAAI,CAAClB,MAAM,CAACwB,mBAAmB,CAAC,IAAI,CAACzB,SAAS,CAAC,CAAC,EACvDmB,MAAM,CAAC,IAAI,CAAClB,MAAM,CAACmB,iBAAiB,CAAC,IAAI,CAACpB,SAAS,CAAC,CAAC,EACrD,IAAI,CAACsB,QAAQ,EACb,IAAI,CAACpB,IAAI,CAACqB,MACZ,CAAC;AACH;AACA,IAAA,OAAO,CAAC,IAAI,CAACb,KAAK,CAACgB,IAAI,EAAE;AACvB;AACC,MAAA,IAAI,CAACzB,MAAM,CAAC0B,OAAO,CAAS,IAAI,CAAC3B,SAAS,CAAC,CAAC4B,OAAO,CAACC,KAAK,GACxD,IAAI,CAACnB,KAAK,CAACoB,YAAY;MACzB,MAAMC,GAAG,EAAE;AACb;AACF;AAEAd,EAAAA,cAAcA,GAAqC;AACjD,IAAA,IAAI,CAAC,IAAI,CAACP,KAAK,EAAE;AACf,MAAA,MAAM,IAAIsB,KAAK,CAAC,CAAA,0BAAA,CAA4B,CAAC;AAC/C;AACF;AACF;;;;"}