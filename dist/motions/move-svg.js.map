{"version":3,"file":"move-svg.js","sources":["../../src/motions/move-svg.ts"],"sourcesContent":["import Motion, { type BaseOptions } from '../-private/motion.ts';\nimport type Sprite from '../-private/sprite.ts';\nimport { type SVGPosition } from '../-private/sprite.ts';\nimport Tween, { type TweenLike } from '../-private/tween.ts';\nimport { rAF } from '../-private/concurrency-helpers.ts';\n\nexport default function moveSVG(\n  dimension: keyof SVGPosition,\n  sprite: Sprite,\n  opts: Partial<MoveSVGOptions> = {},\n) {\n  return new MoveSVG(dimension, sprite, opts).run();\n}\n\nmoveSVG.property = function (propertyName: keyof SVGPosition) {\n  return this.bind(null, propertyName);\n};\n\ninterface MoveSVGOptions extends BaseOptions {\n  easing: (time: number) => number;\n}\n\nexport class MoveSVG extends Motion<MoveSVGOptions> {\n  prior: MoveSVG | null | undefined = null;\n  tween: TweenLike | null = null;\n\n  constructor(\n    readonly dimension: keyof SVGPosition,\n    sprite: Sprite,\n    opts: Partial<MoveSVGOptions> = {},\n  ) {\n    super(sprite, opts);\n  }\n\n  interrupted(motions: Motion[]) {\n    this.prior = motions.find(\n      (m) => m instanceof MoveSVG && m.dimension === this.dimension,\n      // SAFETY: We just checked the type of this\n    ) as MoveSVG | undefined;\n  }\n\n  *animate() {\n    if (this.prior) {\n      let prior: MoveSVG = this.prior;\n      prior.assertHasTween();\n\n      this.tween = new Tween(\n        0,\n        Number(this.sprite.getFinalDimension(this.dimension)) -\n          prior.tween.finalValue,\n        this.duration,\n        this.opts.easing,\n      ).plus(prior.tween);\n    } else {\n      this.tween = new Tween(\n        Number(this.sprite.getInitialDimension(this.dimension)),\n        Number(this.sprite.getFinalDimension(this.dimension)),\n        this.duration,\n        this.opts.easing,\n      );\n    }\n    while (!this.tween.done) {\n      // SAFETY: This is not very safe!\n      (this.sprite.element as any)[this.dimension].baseVal.value =\n        this.tween.currentValue;\n      yield rAF();\n    }\n  }\n\n  assertHasTween(): asserts this is MoveSVGWithTween {\n    if (!this.tween) {\n      throw new Error(`motion does not have tween`);\n    }\n  }\n}\n\ninterface MoveSVGWithTween extends MoveSVG {\n  tween: TweenLike;\n}\n"],"names":["moveSVG","dimension","sprite","opts","MoveSVG","run","property","propertyName","bind","Motion","constructor","_defineProperty","interrupted","motions","prior","find","m","animate","assertHasTween","tween","Tween","Number","getFinalDimension","finalValue","duration","easing","plus","getInitialDimension","done","element","baseVal","value","currentValue","rAF","Error"],"mappings":";;;;;;AAMe,SAASA,OAAOA,CAC7BC,SAA4B,EAC5BC,MAAc,EACdC,IAA6B,GAAG,EAAE,EAClC;AACA,EAAA,OAAO,IAAIC,OAAO,CAACH,SAAS,EAAEC,MAAM,EAAEC,IAAI,CAAC,CAACE,GAAG,EAAE,CAAA;AACnD,CAAA;AAEAL,OAAO,CAACM,QAAQ,GAAG,UAAUC,YAA+B,EAAE;AAC5D,EAAA,OAAO,IAAI,CAACC,IAAI,CAAC,IAAI,EAAED,YAAY,CAAC,CAAA;AACtC,CAAC,CAAA;AAMM,MAAMH,OAAO,SAASK,MAAM,CAAiB;EAIlDC,WAAWA,CACAT,SAA4B,EACrCC,MAAc,EACdC,IAA6B,GAAG,EAAE,EAClC;AACA,IAAA,KAAK,CAACD,MAAM,EAAEC,IAAI,CAAC,CAAA;AAACQ,IAAAA,eAAA,gBARc,IAAI,CAAA,CAAA;AAAAA,IAAAA,eAAA,gBACd,IAAI,CAAA,CAAA;IAAA,IAGnBV,CAAAA,SAA4B,GAA5BA,SAA4B,CAAA;AAKvC,GAAA;EAEAW,WAAWA,CAACC,OAAiB,EAAE;AAC7B,IAAA,IAAI,CAACC,KAAK,GAAGD,OAAO,CAACE,IAAI,CACtBC,CAAC,IAAKA,CAAC,YAAYZ,OAAO,IAAIY,CAAC,CAACf,SAAS,KAAK,IAAI,CAACA,SAAAA;AACpD;KACsB,CAAA;AAC1B,GAAA;;EAEA,CAACgB,OAAOA,GAAG;IACT,IAAI,IAAI,CAACH,KAAK,EAAE;AACd,MAAA,IAAIA,KAAc,GAAG,IAAI,CAACA,KAAK,CAAA;MAC/BA,KAAK,CAACI,cAAc,EAAE,CAAA;MAEtB,IAAI,CAACC,KAAK,GAAG,IAAIC,KAAK,CACpB,CAAC,EACDC,MAAM,CAAC,IAAI,CAACnB,MAAM,CAACoB,iBAAiB,CAAC,IAAI,CAACrB,SAAS,CAAC,CAAC,GACnDa,KAAK,CAACK,KAAK,CAACI,UAAU,EACxB,IAAI,CAACC,QAAQ,EACb,IAAI,CAACrB,IAAI,CAACsB,MACZ,CAAC,CAACC,IAAI,CAACZ,KAAK,CAACK,KAAK,CAAC,CAAA;AACrB,KAAC,MAAM;AACL,MAAA,IAAI,CAACA,KAAK,GAAG,IAAIC,KAAK,CACpBC,MAAM,CAAC,IAAI,CAACnB,MAAM,CAACyB,mBAAmB,CAAC,IAAI,CAAC1B,SAAS,CAAC,CAAC,EACvDoB,MAAM,CAAC,IAAI,CAACnB,MAAM,CAACoB,iBAAiB,CAAC,IAAI,CAACrB,SAAS,CAAC,CAAC,EACrD,IAAI,CAACuB,QAAQ,EACb,IAAI,CAACrB,IAAI,CAACsB,MACZ,CAAC,CAAA;AACH,KAAA;AACA,IAAA,OAAO,CAAC,IAAI,CAACN,KAAK,CAACS,IAAI,EAAE;AACvB;AACC,MAAA,IAAI,CAAC1B,MAAM,CAAC2B,OAAO,CAAS,IAAI,CAAC5B,SAAS,CAAC,CAAC6B,OAAO,CAACC,KAAK,GACxD,IAAI,CAACZ,KAAK,CAACa,YAAY,CAAA;MACzB,MAAMC,GAAG,EAAE,CAAA;AACb,KAAA;AACF,GAAA;AAEAf,EAAAA,cAAcA,GAAqC;AACjD,IAAA,IAAI,CAAC,IAAI,CAACC,KAAK,EAAE;AACf,MAAA,MAAM,IAAIe,KAAK,CAAE,CAAA,0BAAA,CAA2B,CAAC,CAAA;AAC/C,KAAA;AACF,GAAA;AACF;;;;"}